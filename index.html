<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Car Model Selection</title>
</head>
<body>

  <h2>Select Car Make and Year</h2>

  <!-- Make ID input -->
  <label for="makeId">Enter Make ID:</label>
  <input type="number" id="makeId" placeholder="Enter Make ID (e.g., 4)">
  
  <br><br>

  <!-- Year dropdown -->
  <label for="year">Select Year:</label>
  <select id="year">
    <option value="all">All Years (1990â€“2025)</option>
    <!-- Generate year options dynamically -->
  </select>

  <br><br>

  <!-- Button to trigger fetch -->
  <button onclick="fetchCarModels()">Fetch Car Models</button>

  <br><br>

  <!-- Console Output -->
  <div id="output"></div>

  <script>
    // Populate the year dropdown with options from 1990 to 2025
    window.onload = function() {
      const yearSelect = document.getElementById("year");
      for (let year = 1990; year <= 2025; year++) {
        let option = document.createElement("option");
        option.value = year;
        option.textContent = year;
        yearSelect.appendChild(option);
      }
    };

    // Function to fetch car models based on selected year or 'all'
    function fetchCarModels() {
      const makeId = document.getElementById("makeId").value;
      const year = document.getElementById("year").value;
      const outputDiv = document.getElementById("output");

      // Clear previous output
      outputDiv.innerHTML = '';

      // Check if Make ID is provided
      if (!makeId || makeId <= 0) {
        outputDiv.innerHTML = "Please enter a valid Make ID!";
        return;
      }

      // If a specific year is selected
      if (year !== "all") {
        const apiUrl = `https://policywagon.com/api/v1/auto-insurance/lookup/model?makeId=${makeId}&year=${year}`;
        fetchData(apiUrl);
      } 
      // If 'All Years' is selected, loop through all years from 1990 to 2025
      else {
        const modelsSet = new Set(); // Set to store unique models
        for (let year = 1990; year <= 2025; year++) {
          const apiUrl = `https://policywagon.com/api/v1/auto-insurance/lookup/model?makeId=${makeId}&year=${year}`;
          fetchData(apiUrl, modelsSet);
        }
      }
    }

    // Function to fetch data from the API and display it
    function fetchData(apiUrl, modelsSet) {
      fetch(apiUrl)
        .then(response => response.json())
        .then(data => {
          // Check if data is available
          if (data && data.models && data.models.length > 0) {
            data.models.forEach(model => {
              // Add the model name to the set to avoid duplicates
              modelsSet.add(model.name);
            });
          }

          // After collecting all models, display them
          displayModels(modelsSet);
        })
        .catch(error => {
          console.error("Error fetching data:", error);
          const errorMessage = document.createElement("p");
          errorMessage.textContent = "Error fetching data. Please try again.";
          document.getElementById("output").appendChild(errorMessage);
        });
    }

    // Function to display the unique car models
    function displayModels(modelsSet) {
      const outputDiv = document.getElementById("output");

      // Clear the output before displaying new results
      outputDiv.innerHTML = '';

      if (modelsSet.size > 0) {
        modelsSet.forEach(model => {
          const modelInfo = document.createElement("p");
          modelInfo.textContent = model; // Only model name
          outputDiv.appendChild(modelInfo);
        });
      } else {
        const noDataMessage = document.createElement("p");
        noDataMessage.textContent = "No models found for this year.";
        outputDiv.appendChild(noDataMessage);
      }
    }
  </script>

</body>
</html>
